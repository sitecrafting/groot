name: groot
recipe: wordpress
config:
  webroot: wp
  php: '7.4'

services:
  appserver:
    run:
      - composer install
      - scripts/setup-wordpress.sh

  database:
    type: mysql:5.7

  node:
    type: node

    globals:
      webpack: "^4.28"
      yarn: "^1.6"

    run:
      - yarn

  phpmyadmin:
    type: phpmyadmin:4.7

  mailhog:
    type: mailhog:v1.0.0
    hogfrom:
      - appserver

  docs:
    type: nginx
    ssl: true
    webroot: docs/_book

tooling:
  install:
    service: appserver
    cmd: '/app/scripts/setup-wordpress.sh'
    description: 'Install and configure WordPress for custom theme dev'

  yarn:
    service: node

  debug:
    service: appserver
    cmd: 'tail -f /app/wp/wp-content/debug.log'
    description: 'Get real-time WP debug log output'

  webpack:
    service: node
    cmd: 'node_modules/.bin/webpack'
    description: 'Run arbitrary webpack commands'

  sniff:
    service: appserver
    cmd: 'composer sniff'
    description: 'Run phpcs code sniffer'

  sniff-summary:
    service: appserver
    cmd: 'composer sniff-summary'
    description: 'Summarize phpcs results'

  sniff-fix:
    service: appserver
    cmd: 'composer sniff-fix'
    description: 'Fix coding standards issues that are automatically fixable'

proxy:
  appserver:
    - groot.lndo.site

  mailhog:
    - mail.groot.lndo.site
